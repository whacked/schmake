# global variables are any simple key-value pairs
SCHEMAS_DIR: schemas
GENERATORS_DIR: generators

# if "out" is not specified
# the entry key does not "look like" a file,
# output goes to stdout
self-validate:
  in: ${SCHEMAS_DIR}/sdflow.yaml.schema.json
  run: check-jsonschema --schemafile $in sdflow.yaml

# if "out" is not specified,
# AND the entry key begins with a file identifier
# (ONLY ./, / are recognized),
# the entry key is taken as the output file path
./${SCHEMAS_DIR}/sdflow.yaml.schema.json:
  in: ${GENERATORS_DIR}/sdflow.yaml.schema.jsonnet
  run: jsonnet $in | jq -S | tee $out
  out.sha256: a4e842b8fdd9db08748953453272a2d7ce392593ab017f4d2910a454659e4040

./${SCHEMAS_DIR}/runnable.schema.json:
  in: ${GENERATORS_DIR}/runnable.schema.jsonnet
  run: jsonnet $in | jq -S | tee $out

# multiple inputs
schemas:
- ./${SCHEMAS_DIR}/sdflow.yaml.schema.json
- ./${SCHEMAS_DIR}/runnable.schema.json

./runnable.go:
  in: ${SCHEMAS_DIR}/runnable.schema.json
  run: go-jsonschema -p main $in | tee $out

main-program:
  in:  # currently sha256 is only supported for single input
  - main.go
  - ./runnable.go
  - util.go
  out: sdflow
  run: go build -o $out $in

example-web-loader:
  in: https://example.com
  in.sha256: ea8fac7c65fb589b0d53560f5251f74f9e9b243478dcb6b3ea79b5e36449c8d9
  run: curl -s $in | grep -i title

example-s3-loader:
  in: s3://answer-reformulation-pds/README.txt
  in.sha256: b24b59e210cefd4d964413ac555e4573470909f8aa3d16b6b9a65ddb04490b69
  run: date